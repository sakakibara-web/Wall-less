using UnityEngine;
using UnityEngine.UI;
using System.Collections;

public class TextFeedAnimation : MonoBehaviour
{
    [Header("?t?F?[?h??????Image")]
    [Tooltip("???????t?F?[?h????????UI Image???h???b?O???h???b?v????????????")]
    public Image targetImage;

    [Header("?t?F?[?h????")]
    [Tooltip("?t?F?[?h?C???????????????i?b?j")]
    public float fadeInDuration = 4f;
    [Tooltip("?t?F?[?h?C??????????????????????????????i?b?j")]
    public float displayDuration = 2f;
    [Tooltip("?t?F?[?h?A?E?g?????????????i?b?j")]
    public float fadeOutDuration = 4f;

    private Color originalColor;

    void Awake()
    {
        if (targetImage == null)
        {
            Debug.LogError("TextFeedAnimation: ?t?F?[?h?????? Image ???A?T?C?????????????????B");
            enabled = false;
            return;
        }

        // ?I???W?i?????F?????????????A?J?n??????????
        originalColor = targetImage.color;
        var c = originalColor;
        c.a = 0f;
        targetImage.color = c;
    }

    void Start()
    {
        StartCoroutine(FadeInAndOut());
    }

    private IEnumerator FadeInAndOut()
    {
        float timer = 0f;

        // ===== ?t?F?[?h?C?? =====
        while (timer < fadeInDuration)
        {
            timer += Time.deltaTime;
            float alpha = Mathf.Clamp01(timer / fadeInDuration);
            var c = originalColor;
            c.a = alpha;
            targetImage.color = c;
            yield return null;
        }

        // ===== ?\???L?[?v =====
        yield return new WaitForSeconds(displayDuration);

        // ===== ?t?F?[?h?A?E?g =====
        timer = 0f;
        while (timer < fadeOutDuration)
        {
            timer += Time.deltaTime;
            float alpha = Mathf.Clamp01(1f - (timer / fadeOutDuration));
            var c = originalColor;
            c.a = alpha;
            targetImage.color = c;
            yield return null;
        }

        // ?K?v???????????I?u?W?F?N?g?????A?N?e?B?u??
        // targetImage.gameObject.SetActive(false);
    }
}
